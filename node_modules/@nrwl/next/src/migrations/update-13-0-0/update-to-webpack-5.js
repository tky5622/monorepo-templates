"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.update = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
function update(host) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projects = (0, devkit_1.getProjects)(host);
        let task = undefined;
        projects.forEach((project) => {
            const configPath = (0, devkit_1.joinPathFragments)(project.root, 'next.config.js');
            if (!host.exists(configPath))
                return;
            const content = host.read(configPath).toString();
            let updated = content.replace(/webpack5: false/, 'webpack5: true');
            if (content.match(/@zeit\/next-less/)) {
                updated = updated.replace('@zeit/next-less', 'next-with-less');
                task = (0, devkit_1.addDependenciesToPackageJson)(host, { 'next-with-less': '1.0.1' }, {});
            }
            if (content.match(/@zeit\/next-stylus/)) {
                updated = updated.replace('@zeit/next-stylus', '@nrwl/next/plugins/with-stylus');
                task = (0, devkit_1.addDependenciesToPackageJson)(host, { 'stylus-loader': '6.2.0' }, {});
            }
            host.write(configPath, updated);
        });
        yield (0, devkit_1.formatFiles)(host);
        return task;
    });
}
exports.update = update;
exports.default = update;
//# sourceMappingURL=update-to-webpack-5.js.map