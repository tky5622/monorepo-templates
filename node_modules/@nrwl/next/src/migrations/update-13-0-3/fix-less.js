"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.update = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
function update(host) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projects = (0, devkit_1.getProjects)(host);
        let task = undefined;
        projects.forEach((project) => {
            const configPath = (0, devkit_1.joinPathFragments)(project.root, 'next.config.js');
            if (!host.exists(configPath))
                return;
            const content = host.read(configPath).toString();
            if (content.match(/next-with-less/)) {
                const updated = content.replace('next-with-less', '@nrwl/next/plugins/with-less');
                task = (0, devkit_1.addDependenciesToPackageJson)(host, { 'less-loader': '10.2.0' }, {});
                host.write(configPath, updated);
            }
        });
        yield (0, devkit_1.formatFiles)(host);
        return task;
    });
}
exports.update = update;
exports.default = update;
//# sourceMappingURL=fix-less.js.map