const a8_0x3aa9=['DistributedExecutionApi','criticalErrorMessage','addVerticalSeparator','value','Unable\x20to\x20complete\x20a\x20run.','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','startTask','commandStatus','start','taskGraph','retrieve','../../../utilities/create-unchanged-value-timeout','status','assign','\x20seconds.','executionStatus:\x20','next','executionId:\x20','exit','createUnchangedValueTimeout','strictlyOrderedTargets','splitTasksIntoStages','E2EEncryption','submitRunMetrics','No\x20new\x20completed\x20tasks\x20after\x20','./distributed-execution.api','FileStorage','projectGraph','SIGINT','Waiter','url','get','taskId','nxCloudDistributedTasksRunner','completeRunGroupWithError','Starting\x20distributed\x20command\x20execution','join','scheduleTask','COMPLETED','error','Status\x20update','run','hash','log','../../file-storage/file-storage','Main\x20job\x20was\x20terminated\x20via\x20SIGINT','cacheDirectory','../../../utilities/nx-imports','Found\x20unknown\x20task:\x20','parse','executionStatus','length','Command\x20execution\x20failed.','find','getRunGroup','../../file-storage/e2e-encryption','ENCRYPTION_KEY','throw','write','printRunGroupError','tasks','NO_COMPLETED_TASKS_TIMEOUT','terminalOutput','dependencies','strip-json-comments','completedTasks','createTaskGraph','note','push','axiosException','serializeOverrides','./split-task-graph-into-stages','success','Processing\x20task\x20','/nx.json','toString','number\x20of\x20completed\x20tasks:\x20','reset','See\x20run\x20details\x20at\x20','build','./node_modules/.cache/nx','lifeCycle','endTask','TaskGraphCreator','VERBOSE_LOGGING','nodes','Successfully\x20completed\x20running\x20the\x20command.','logCommand','Waiting...','target'];(function(_0x15b170,_0x3aa91d){const _0x52320c=function(_0x4972e4){while(--_0x4972e4){_0x15b170['push'](_0x15b170['shift']());}};_0x52320c(++_0x3aa91d);}(a8_0x3aa9,0xbf));const a8_0x5232=function(_0x15b170,_0x3aa91d){_0x15b170=_0x15b170-0x0;let _0x52320c=a8_0x3aa9[_0x15b170];return _0x52320c;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x27efc6,_0x3cf25e,_0x98e8ff,_0x30098a){function _0x3c6efd(_0x29492f){return _0x29492f instanceof _0x98e8ff?_0x29492f:new _0x98e8ff(function(_0x1d31dc){_0x1d31dc(_0x29492f);});}return new(_0x98e8ff||(_0x98e8ff=Promise))(function(_0x248d0b,_0xa769d6){function _0x509116(_0x1d8dd5){try{_0x5ec1ba(_0x30098a['next'](_0x1d8dd5));}catch(_0x1e3101){_0xa769d6(_0x1e3101);}}function _0x35c7d2(_0x3aca29){try{_0x5ec1ba(_0x30098a[a8_0x5232('0x2e')](_0x3aca29));}catch(_0x40b738){_0xa769d6(_0x40b738);}}function _0x5ec1ba(_0x29f9e5){_0x29f9e5['done']?_0x248d0b(_0x29f9e5[a8_0x5232('0x52')]):_0x3c6efd(_0x29f9e5[a8_0x5232('0x52')])['then'](_0x509116,_0x35c7d2);}_0x5ec1ba((_0x30098a=_0x30098a['apply'](_0x27efc6,_0x3cf25e||[]))[a8_0x5232('0x5')]());});};Object['defineProperty'](exports,'__esModule',{'value':!![]});exports['nxCloudDistributedTasksRunner']=void 0x0;const fs_1=require('fs');const stripJsonComments=require(a8_0x5232('0x35'));const create_unchanged_value_timeout_1=require(a8_0x5232('0x0'));const environment_1=require('../../../utilities/environment');const metric_logger_1=require('../../../utilities/metric-logger');const serializer_overrides_1=require('../../../utilities/serializer-overrides');const waiter_1=require('../../../utilities/waiter');const error_reporter_api_1=require('../../api/error-reporter.api');const print_run_group_error_1=require('../../error/print-run-group-error');const e2e_encryption_1=require(a8_0x5232('0x2c'));const file_storage_1=require(a8_0x5232('0x21'));const distributed_execution_api_1=require(a8_0x5232('0xe'));const split_task_graph_into_stages_1=require(a8_0x5232('0x3c'));const task_graph_creator_1=require('./task-graph-creator');const {output,workspaceRoot,getOutputs,Cache}=require(a8_0x5232('0x24'));class NoopLifeCycle{[a8_0x5232('0x1a')](_0x857c04){}[a8_0x5232('0x55')](_0x26eee6){}[a8_0x5232('0x47')](_0xa97ade,_0x299af4){}}function runDistributedExecution(_0x3c2766,_0x13e171,_0x349218,_0x1b453b,_0x127c78,_0x377086,_0x3a048a){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x133c86=yield _0x3c2766[a8_0x5232('0x57')]((0x0,distributed_execution_api_1['createStartRequest'])(_0x377086,(0x0,split_task_graph_into_stages_1[a8_0x5232('0xa')])(_0x3a048a),_0x13e171));return yield processTasks(_0x3c2766,_0x1b453b,_0x127c78,_0x13e171,_0x133c86,Object['values'](_0x3a048a[a8_0x5232('0x31')]),_0x349218);});}function processTasks(_0x569853,_0x2ca863,_0x2ffb52,_0x4ea61a,_0x4949bc,_0x17e6a3,_0x5dfe3e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x34cd9e={};const _0x4d3448=(0x0,create_unchanged_value_timeout_1[a8_0x5232('0x8')])({'title':a8_0x5232('0xd')+environment_1[a8_0x5232('0x32')]/0x3e8+a8_0x5232('0x3'),'timeout':environment_1[a8_0x5232('0x32')]});const _0x35c9a0=new waiter_1[(a8_0x5232('0x12'))]();while(!![]){if(environment_1[a8_0x5232('0x49')]){output['note']({'title':a8_0x5232('0x4d')});}yield _0x35c9a0['wait']();const _0x5d1b76=yield _0x569853[a8_0x5232('0x1')](_0x4949bc);if(environment_1[a8_0x5232('0x49')]){output[a8_0x5232('0x38')]({'title':a8_0x5232('0x1d'),'bodyLines':[a8_0x5232('0x6')+_0x4949bc,a8_0x5232('0x4')+_0x5d1b76[a8_0x5232('0x27')],a8_0x5232('0x41')+_0x5d1b76[a8_0x5232('0x36')][a8_0x5232('0x28')],'error:\x20'+_0x5d1b76[a8_0x5232('0x50')]]});}if(_0x5d1b76[a8_0x5232('0x50')]){output[a8_0x5232('0x1c')]({'title':'Distributed\x20Execution\x20Terminated','bodyLines':['Error:',_0x5d1b76['criticalErrorMessage']]});process[a8_0x5232('0x7')](0x1);}_0x4d3448(_0x5d1b76[a8_0x5232('0x36')][a8_0x5232('0x28')]);for(const _0xde803b of _0x5d1b76[a8_0x5232('0x36')]){if(_0x34cd9e[_0xde803b[a8_0x5232('0x15')]])continue;yield processTask(_0x2ca863,_0x2ffb52,_0x5dfe3e,_0x4ea61a,_0x17e6a3,_0xde803b);_0x35c9a0[a8_0x5232('0x42')]();_0x34cd9e[_0xde803b[a8_0x5232('0x15')]]=!![];}if(_0x5d1b76[a8_0x5232('0x27')]===a8_0x5232('0x1b')){return{'commandStatus':_0x5d1b76[a8_0x5232('0x56')],'runUrl':_0x5d1b76['runUrl']};}}});}function processTask(_0x5a7602,_0x9b8230,_0x45d23d,_0x42ad7b,_0x3fffd6,_0x3cecfd){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1['VERBOSE_LOGGING']){output[a8_0x5232('0x38')]({'title':a8_0x5232('0x3e')+_0x3cecfd[a8_0x5232('0x15')]});}const _0x13e799=_0x3fffd6[a8_0x5232('0x2a')](_0xc5a5dd=>_0x3cecfd[a8_0x5232('0x15')]===_0xc5a5dd['id']);if(!_0x13e799){throw new Error(a8_0x5232('0x25')+_0x3cecfd[a8_0x5232('0x15')]);}if(environment_1[a8_0x5232('0x49')]){output[a8_0x5232('0x38')]({'title':'Retrieving\x20artifacts\x20from\x20'+_0x3cecfd['url']});}yield _0x5a7602[a8_0x5232('0x59')](_0x3cecfd['hash'],_0x3cecfd[a8_0x5232('0x13')],_0x42ad7b[a8_0x5232('0x23')]||a8_0x5232('0x45'));const _0x4b2d38=yield _0x9b8230[a8_0x5232('0x14')](Object[a8_0x5232('0x2')](Object['assign']({},_0x13e799),{'hash':_0x3cecfd[a8_0x5232('0x1f')]}));const _0x566e16=getOutputs(_0x45d23d[a8_0x5232('0x10')][a8_0x5232('0x4a')],_0x13e799);if(environment_1[a8_0x5232('0x49')]){output['note']({'title':'Extracting\x20artifacts','bodyLines':_0x566e16});}yield _0x9b8230['copyFilesFromCache'](_0x3cecfd[a8_0x5232('0x1f')],_0x4b2d38,_0x566e16);output[a8_0x5232('0x4c')](getCommand(_0x13e799));process['stdout'][a8_0x5232('0x2f')](_0x4b2d38[a8_0x5232('0x33')]);output[a8_0x5232('0x51')]();});}function getCommand(_0xa6bcbd){const _0x495864=_0xa6bcbd[a8_0x5232('0x4e')]['configuration']?':'+_0xa6bcbd[a8_0x5232('0x4e')]['configuration']:'';return['nx',a8_0x5232('0x1e'),_0xa6bcbd[a8_0x5232('0x4e')]['project']+':'+_0xa6bcbd[a8_0x5232('0x4e')]['target']+_0x495864,(0x0,serializer_overrides_1[a8_0x5232('0x3b')])(_0xa6bcbd)][a8_0x5232('0x19')]('\x20');}function attachSignalListenersToCompleteRunGroupOnError(_0xe46f1a,_0x2c105c){process['on'](a8_0x5232('0x11'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0xe46f1a['completeRunGroupWithError'](_0x2c105c,a8_0x5232('0x22'));process[a8_0x5232('0x7')](0x1);}));process['on']('SIGTERM',()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0xe46f1a[a8_0x5232('0x17')](_0x2c105c,'Main\x20job\x20was\x20terminated\x20via\x20SIGTERM');process[a8_0x5232('0x7')](0x1);}));}const nxCloudDistributedTasksRunner=(_0x102f4c,_0x172b7f,_0x586a34)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(environment_1[a8_0x5232('0x49')]){output[a8_0x5232('0x38')]({'title':a8_0x5232('0x18')});}_0x172b7f[a8_0x5232('0x46')]=new NoopLifeCycle();const _0x1639ec=(0x0,environment_1[a8_0x5232('0x2b')])();if(!_0x1639ec){(0x0,print_run_group_error_1[a8_0x5232('0x30')])();return process[a8_0x5232('0x7')](0x1);}const _0x435b25=new e2e_encryption_1[(a8_0x5232('0xb'))](environment_1[a8_0x5232('0x2d')]||_0x172b7f['encryptionKey']);const _0x2a715d=new error_reporter_api_1['ErrorReporterApi'](_0x172b7f);const _0x28ffaa=new file_storage_1[(a8_0x5232('0xf'))](_0x435b25,_0x2a715d,!![],![]);const _0x38f8f5=new Cache(_0x172b7f);const _0x39e627=new distributed_execution_api_1[(a8_0x5232('0x4f'))](_0x172b7f);attachSignalListenersToCompleteRunGroupOnError(_0x39e627,_0x1639ec);try{const _0x397af9=getTaskGraph(_0x586a34,_0x102f4c,_0x172b7f);const _0x42cf6e=yield runDistributedExecution(_0x39e627,_0x172b7f,_0x586a34,_0x28ffaa,_0x38f8f5,_0x1639ec,_0x397af9);if(_0x42cf6e[a8_0x5232('0x56')]===0x0){output[a8_0x5232('0x3d')]({'title':a8_0x5232('0x4b'),'bodyLines':[a8_0x5232('0x43')+_0x42cf6e['runUrl']]});}else{output[a8_0x5232('0x1c')]({'title':a8_0x5232('0x29'),'bodyLines':[a8_0x5232('0x43')+_0x42cf6e['runUrl']]});}yield(0x0,metric_logger_1[a8_0x5232('0xc')])(_0x172b7f);process[a8_0x5232('0x7')](_0x42cf6e[a8_0x5232('0x56')]);}catch(_0x446d45){output['error']({'title':a8_0x5232('0x53'),'bodyLines':[_0x446d45['message']]});if(_0x446d45[a8_0x5232('0x3a')]){console['log'](_0x446d45[a8_0x5232('0x3a')]);}else{console[a8_0x5232('0x20')](_0x446d45);}try{yield _0x39e627[a8_0x5232('0x17')](_0x1639ec,a8_0x5232('0x54')+_0x446d45['message']+'\x22');}finally{process[a8_0x5232('0x7')](0x1);}}});exports[a8_0x5232('0x16')]=nxCloudDistributedTasksRunner;function getTaskGraph(_0x19c3c9,_0x23a218,_0x19baef){if(_0x19c3c9[a8_0x5232('0x58')]){return _0x19c3c9[a8_0x5232('0x58')];}else{const _0x58a6aa=JSON[a8_0x5232('0x26')](stripJsonComments((0x0,fs_1['readFileSync'])(workspaceRoot+a8_0x5232('0x3f'))[a8_0x5232('0x40')]()));return new task_graph_creator_1[(a8_0x5232('0x48'))](_0x19c3c9[a8_0x5232('0x10')],getDefaultDependencyConfigs(_0x58a6aa,_0x19baef))[a8_0x5232('0x37')](_0x23a218);}}function getDefaultDependencyConfigs(_0x15aa6a,_0x56ee67){var _0xe59987,_0x45fce3;const _0x14ac0c=(_0xe59987=_0x15aa6a['targetDependencies'])!==null&&_0xe59987!==void 0x0?_0xe59987:{};const _0x46b2eb=_0x56ee67?(_0x45fce3=_0x56ee67[a8_0x5232('0x9')])!==null&&_0x45fce3!==void 0x0?_0x45fce3:[a8_0x5232('0x44')]:[];for(const _0x1cec2d of _0x46b2eb){_0x14ac0c[_0x1cec2d]=_0x14ac0c[_0x1cec2d]||[];_0x14ac0c[_0x1cec2d][a8_0x5232('0x39')]({'target':_0x1cec2d,'projects':a8_0x5232('0x34')});}return _0x14ac0c;}