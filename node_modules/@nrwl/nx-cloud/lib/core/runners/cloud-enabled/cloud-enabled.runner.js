const a1_0x443f=['indexOf','toISOString','encryptionKey','rxjs/internal/Subject','OutputObfuscator','../../file-storage/e2e-encryption','getMachineInfo','printCacheHitsMessage','endsWith','complete','map','Executed\x20tasks\x20with\x20hashes:\x20','Nx\x20Cloud\x20Problems','filter','next','env','exit','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','error','__awaiter','push','endRun','ErrorReporterApi','then','join','./id-generator','taskId','message','../../api/error-reporter.api','__esModule','skipNxCache','warn','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','@nrwl/nx-cloud/lib/daemon/process-run-end','value','../../terminal-output/message-reporter','../../file-storage/file-storage','cacheDirectory','url','waitForStoreRequestsToComplete','runUrl','requests','hash','../../terminal-output/end-of-run-message','subscribe','./cloud-remote-cache','length','MessageReporter','obfuscate','printMessages','../../../utilities/metric-logger','https://nx.app','daemon','CloudRemoteCache','E2EEncryption','writeFileSync','processInBackground','../../../utilities/nx-imports','accessToken','scan','done','CloudRunApi','path','anyErrors','stringify','../../../utilities/environment','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','generateUniqueLinkId','ENCRYPTION_KEY','CloudEnabledLifeCycle','tasks-hashes-','throw','.commit','lifeCycle','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','EndOfRunMessage','toString','catch','cloudEnabledTasksRunner','api.nrwl.io','.nx.app','defineProperty','VERBOSE_LOGGING','../../terminal-output/output-obfuscator','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','FileStorage','./cloud-run.api','parseCommand','cacheableOperations','assign','submitRunMetrics','uploads'];(function(_0x5e9318,_0x443f66){const _0x41c4e1=function(_0x13d6ba){while(--_0x13d6ba){_0x5e9318['push'](_0x5e9318['shift']());}};_0x41c4e1(++_0x443f66);}(a1_0x443f,0x1f1));const a1_0x41c4=function(_0x5e9318,_0x443f66){_0x5e9318=_0x5e9318-0x0;let _0x41c4e1=a1_0x443f[_0x5e9318];return _0x41c4e1;};'use strict';var __awaiter=this&&this[a1_0x41c4('0x4a')]||function(_0x126de3,_0x4ea62d,_0x54bd41,_0x4b0685){function _0x2d2914(_0x31d032){return _0x31d032 instanceof _0x54bd41?_0x31d032:new _0x54bd41(function(_0x127442){_0x127442(_0x31d032);});}return new(_0x54bd41||(_0x54bd41=Promise))(function(_0x33f3ac,_0x48704e){function _0x533e61(_0x34091a){try{_0x5e1482(_0x4b0685[a1_0x41c4('0x45')](_0x34091a));}catch(_0x39c500){_0x48704e(_0x39c500);}}function _0x16fc7f(_0x45a683){try{_0x5e1482(_0x4b0685[a1_0x41c4('0x22')](_0x45a683));}catch(_0x4cd27f){_0x48704e(_0x4cd27f);}}function _0x5e1482(_0x20dc8a){_0x20dc8a[a1_0x41c4('0x17')]?_0x33f3ac(_0x20dc8a[a1_0x41c4('0x59')]):_0x2d2914(_0x20dc8a[a1_0x41c4('0x59')])[a1_0x41c4('0x4e')](_0x533e61,_0x16fc7f);}_0x5e1482((_0x4b0685=_0x4b0685['apply'](_0x126de3,_0x4ea62d||[]))['next']());});};Object[a1_0x41c4('0x2c')](exports,a1_0x41c4('0x54'),{'value':!![]});exports[a1_0x41c4('0x29')]=void 0x0;const message_reporter_1=require(a1_0x41c4('0x5a'));const end_of_run_message_1=require(a1_0x41c4('0x6'));const output_obfuscator_1=require(a1_0x41c4('0x2e'));const cloud_enabled_life_cycle_1=require('./cloud-enabled-life-cycle');const file_storage_1=require(a1_0x41c4('0x5b'));const e2e_encryption_1=require(a1_0x41c4('0x3c'));const environment_1=require(a1_0x41c4('0x1c'));const cloud_remote_cache_1=require(a1_0x41c4('0x8'));const cloud_run_api_1=require(a1_0x41c4('0x31'));const fs_1=require('fs');const path=require(a1_0x41c4('0x19'));const metric_logger_1=require(a1_0x41c4('0xd'));const error_reporter_api_1=require(a1_0x41c4('0x53'));const path_1=require(a1_0x41c4('0x19'));const fs_extra_1=require('fs-extra');const id_generator_1=require(a1_0x41c4('0x50'));const {tasksRunner,output,Cache}=require(a1_0x41c4('0x14'));function createApi(_0x28ac43,_0x48673f,_0x1420ff){const _0x3275f5=(0x0,environment_1[a1_0x41c4('0x3d')])(_0x48673f);return new cloud_run_api_1[(a1_0x41c4('0x18'))](_0x28ac43,_0x1420ff,_0x48673f,_0x3275f5);}function storeTaskHashes(_0x493a35,_0x18853c,_0x499984){const _0x34f6c7=JSON[a1_0x41c4('0x1b')](_0x493a35[a1_0x41c4('0x41')](_0x1e5749=>({'taskId':_0x1e5749[a1_0x41c4('0x51')],'hash':_0x1e5749[a1_0x41c4('0x5')]})));if(environment_1[a1_0x41c4('0x2d')]){output['note']({'title':a1_0x41c4('0x42')+_0x34f6c7});}(0x0,fs_1[a1_0x41c4('0x12')])(path[a1_0x41c4('0x4f')](_0x18853c,a1_0x41c4('0x21')+_0x499984),_0x34f6c7);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1a3112=new Date()[a1_0x41c4('0x38')]();const _0x7cb9bd=(0x0,environment_1['getBranch'])();const _0xeaaf07={'command':outputObfuscator[a1_0x41c4('0xb')]((0x0,environment_1[a1_0x41c4('0x32')])()),'startTime':runStartTime,'endTime':_0x1a3112,'distributedExecutionId':environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'],'branch':_0x7cb9bd,'scan':!![],'runGroup':(0x0,environment_1['getRunGroup'])(),'sha':_0x7cb9bd?(0x0,environment_1['extractGitSha'])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1[a1_0x41c4('0x2f')]){storeTaskHashes(taskExecutions,options[a1_0x41c4('0x0')]||'./node_modules/.cache/nx',environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID']);}try{yield remoteCache[a1_0x41c4('0x2')]();}catch(_0x146761){output[a1_0x41c4('0x49')]({'title':a1_0x41c4('0x48')});messages[a1_0x41c4('0xc')]();process[a1_0x41c4('0x47')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}try{yield api[a1_0x41c4('0x4c')](_0xeaaf07,taskExecutions);}catch(_0x3f00cc){output[a1_0x41c4('0x49')]({'title':a1_0x41c4('0x1d')});messages['printMessages']();process[a1_0x41c4('0x47')](environment_1[a1_0x41c4('0x57')]);}yield(0x0,metric_logger_1[a1_0x41c4('0x35')])(options);}else{try{const _0x5e9f92=environment_1['ACCESS_TOKEN']?environment_1['ACCESS_TOKEN']:options[a1_0x41c4('0x15')];const _0x48ccd4=(0x0,id_generator_1[a1_0x41c4('0x1e')])();yield daemon[a1_0x41c4('0x13')](a1_0x41c4('0x58'),{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x41c4('0x34')](Object[a1_0x41c4('0x34')]({},options),{'accessToken':_0x5e9f92}),'uploads':fileStorage[a1_0x41c4('0x36')],'runEnd':{'runData':_0xeaaf07,'taskExecutions':taskExecutions,'linkId':_0x48ccd4}});runContext[a1_0x41c4('0x3')]=(options[a1_0x41c4('0x1')]||a1_0x41c4('0xe'))+'/runs/'+_0x48ccd4;}catch(_0x21d579){output[a1_0x41c4('0x56')]({'title':a1_0x41c4('0x43'),'bodyLines':[_0x21d579[a1_0x41c4('0x52')]||_0x21d579[a1_0x41c4('0x27')]()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x41c4('0xc')]();if(!messages[a1_0x41c4('0x1a')]&&!inner){endOfRunMessage[a1_0x41c4('0x3e')]();}},0x0);}else{messages[a1_0x41c4('0xc')]();if(!messages[a1_0x41c4('0x1a')]&&!inner){endOfRunMessage[a1_0x41c4('0x3e')]();}}});}function createLifeCycle(_0x198ef9,_0x5e31a6,_0x43c50f,_0x1a8f1a){const _0x4b3976=new cloud_enabled_life_cycle_1[(a1_0x41c4('0x20'))](_0x198ef9,_0x5e31a6[a1_0x41c4('0x0')],!!_0x5e31a6[a1_0x41c4('0x55')],_0x5e31a6[a1_0x41c4('0x16')]===undefined?!![]:_0x5e31a6[a1_0x41c4('0x16')],_0x5e31a6[a1_0x41c4('0x33')]||[],_0x43c50f,_0x1a8f1a);try{const {CompositeLifeCycle}=require(a1_0x41c4('0x14'));if(!CompositeLifeCycle)return _0x4b3976;return new CompositeLifeCycle([_0x5e31a6['lifeCycle'],_0x4b3976]);}catch(_0x170515){return _0x4b3976;}}function fetchUrlsForKnownHashesUpfront(_0x1f6482,_0x574b67,_0x51bb85,_0xfd2507){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x3230fa=_0x51bb85['map'](_0xf086e6=>_0xf086e6[a1_0x41c4('0x5')])[a1_0x41c4('0x44')](_0x4dac51=>!!_0x4dac51);const _0x154ed6=new Cache(_0xfd2507);if(!_0xfd2507['skipNxCache']){const _0x8fa7dc=yield Promise['all'](_0x3230fa[a1_0x41c4('0x41')](_0x31e9dc=>{const _0x10c267=(0x0,path_1[a1_0x41c4('0x4f')])(_0x154ed6['cachePath'],_0x31e9dc+a1_0x41c4('0x23'));return(0x0,fs_extra_1['pathExists'])(_0x10c267);}));const _0x18f286=[];for(let _0x49f7d7=0x0;_0x49f7d7<_0x8fa7dc[a1_0x41c4('0x9')];++_0x49f7d7){if(_0x8fa7dc[_0x49f7d7]){_0x18f286[a1_0x41c4('0x4b')](_0x3230fa[_0x49f7d7]);}}_0x3230fa=_0x18f286;}if(_0x3230fa['length']>0x0){const _0x3de0a0=_0x1f6482['startRun'](environment_1[a1_0x41c4('0x25')],_0x3230fa);for(const _0x2d17e0 of _0x3230fa){_0x574b67[a1_0x41c4('0x4')][_0x2d17e0]=_0x3de0a0;}}});}function isConnectedToPrivateCloud(_0x246785){if(!_0x246785[a1_0x41c4('0x1')])return![];if(_0x246785[a1_0x41c4('0x1')][a1_0x41c4('0x3f')](a1_0x41c4('0x2a')))return![];if(_0x246785[a1_0x41c4('0x1')]['endsWith'](a1_0x41c4('0x2b')))return![];if(_0x246785['url'][a1_0x41c4('0x37')]('localhost')>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x2f5843,_0x13ad23,_0x5198cc,_0xafbaf0=![]){var _0x187b33;const _0x395324={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x2f5843};const _0x223dcd=_0x13ad23[a1_0x41c4('0x24')]===undefined;const _0x344508=[];const _0x1cb1d3=new message_reporter_1[(a1_0x41c4('0xa'))](_0x13ad23);const _0x49e643=createApi(_0x1cb1d3,_0x13ad23,_0x395324);const _0x44ad61=new end_of_run_message_1[(a1_0x41c4('0x26'))](_0x395324,_0x344508);const _0x38af7d=new output_obfuscator_1[(a1_0x41c4('0x3b'))](_0x13ad23['maskedProperties']);const _0x4eb840=new Date()[a1_0x41c4('0x38')]();const _0x55e964=createLifeCycle(_0x395324,_0x13ad23,_0x38af7d,_0x344508);const _0x4af367=environment_1[a1_0x41c4('0x1f')]||_0x13ad23[a1_0x41c4('0x39')];const _0x14f39b=new e2e_encryption_1[(a1_0x41c4('0x11'))](_0x4af367);const _0x572ce9=new error_reporter_api_1[(a1_0x41c4('0x4d'))](_0x13ad23);const _0x3efc14=!!environment_1[a1_0x41c4('0x2f')]||!((_0x187b33=_0x5198cc['daemon'])===null||_0x187b33===void 0x0?void 0x0:_0x187b33['enabled']())||isConnectedToPrivateCloud(_0x13ad23);const _0x4c36db=new file_storage_1[(a1_0x41c4('0x30'))](_0x14f39b,_0x572ce9,![],_0x3efc14);const _0x4abca=new cloud_remote_cache_1[(a1_0x41c4('0x10'))](_0x1cb1d3,_0x49e643,_0x395324,_0x4c36db);fetchUrlsForKnownHashesUpfront(_0x49e643,_0x395324,_0x2f5843,_0x13ad23);delete process[a1_0x41c4('0x46')]['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'];const _0xb9aea=tasksRunner(_0x2f5843,Object['assign'](Object[a1_0x41c4('0x34')]({},_0x13ad23),{'remoteCache':_0x4abca,'lifeCycle':_0x55e964}),_0x5198cc);if(_0xb9aea[a1_0x41c4('0x7')]){const {Subject}=require(a1_0x41c4('0x3a'));const _0x44ea32=new Subject();_0xb9aea[a1_0x41c4('0x7')]({'next':_0x279dd4=>_0x44ea32['next'](_0x279dd4),'error':_0x319fcb=>_0x44ea32[a1_0x41c4('0x49')](_0x319fcb),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x5198cc[a1_0x41c4('0xf')],'lifeCycle':_0x55e964,'options':_0x13ad23,'remoteCache':_0x4abca,'api':_0x49e643,'outputObfuscator':_0x38af7d,'runStartTime':_0x4eb840,'messages':_0x1cb1d3,'endOfRunMessage':_0x44ad61,'taskExecutions':_0x344508,'versionOfNxBefore133':_0x223dcd,'inner':_0xafbaf0,'encryptionKey':_0x4af367,'fileStorage':_0x4c36db,'uploadInCurrentProcess':_0x3efc14,'runContext':_0x395324});_0x44ea32[a1_0x41c4('0x40')]();})});return _0x44ea32;}else{return _0xb9aea[a1_0x41c4('0x4e')](_0x282114=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x5198cc[a1_0x41c4('0xf')],'lifeCycle':_0x55e964,'options':_0x13ad23,'remoteCache':_0x4abca,'api':_0x49e643,'outputObfuscator':_0x38af7d,'runStartTime':_0x4eb840,'messages':_0x1cb1d3,'endOfRunMessage':_0x44ad61,'taskExecutions':_0x344508,'versionOfNxBefore133':_0x223dcd,'inner':_0xafbaf0,'encryptionKey':_0x4af367,'fileStorage':_0x4c36db,'uploadInCurrentProcess':_0x3efc14,'runContext':_0x395324});return _0x282114;}))[a1_0x41c4('0x28')](_0x425d7c=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x5198cc[a1_0x41c4('0xf')],'lifeCycle':_0x55e964,'options':_0x13ad23,'remoteCache':_0x4abca,'api':_0x49e643,'outputObfuscator':_0x38af7d,'runStartTime':_0x4eb840,'messages':_0x1cb1d3,'endOfRunMessage':_0x44ad61,'taskExecutions':_0x344508,'versionOfNxBefore133':_0x223dcd,'inner':_0xafbaf0,'encryptionKey':_0x4af367,'fileStorage':_0x4c36db,'uploadInCurrentProcess':_0x3efc14,'runContext':_0x395324});throw _0x425d7c;}));}}exports['cloudEnabledTasksRunner']=cloudEnabledTasksRunner;