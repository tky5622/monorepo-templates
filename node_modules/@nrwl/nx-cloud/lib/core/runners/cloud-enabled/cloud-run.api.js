const a3_0x19e1=['then','axiosException','note','data','map','RunEnd\x20duration','createReqBody','extractErrorMessage','status','runContext','/nx-cloud/runs/end','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','unknown','promisify','post','urls','startRun','next','VERBOSE_LOGGING','CloudRunApi','api','success','endRun','RunStart\x20duration','value','util','slice','axiosMultipleTries','terminalOutput','RUNNER_FAILURE_PERF_ENTRY','length','from','../../../utilities/metric-logger','throw','assign','apiError','Stack\x20Trace:','response','Invalid\x20Nx\x20Cloud\x20response:\x20','mapRespToPerfEntry','stringify','Run\x20completion\x20responded\x20with\x20`undefined`.','defaults','__esModule','stack','apiAxiosInstance','Invalid\x20end\x20run\x20response:\x20','../../../utilities/axios','message','application/octet-stream','done','parse','gzip','Invalid\x20end\x20run\x20response','string','__awaiter','messages','recordMetric','toString','nxCloudVersion','headers','RunEnd.\x20Completed\x20tasks','defineProperty','machineInfo','runUrl','Run\x20Details:','/nx-cloud/runs/start','apply'];(function(_0xb1f67a,_0x19e18f){const _0x826fbc=function(_0xeeedb8){while(--_0xeeedb8){_0xb1f67a['push'](_0xb1f67a['shift']());}};_0x826fbc(++_0x19e18f);}(a3_0x19e1,0x92));const a3_0x826f=function(_0xb1f67a,_0x19e18f){_0xb1f67a=_0xb1f67a-0x0;let _0x826fbc=a3_0x19e1[_0xb1f67a];return _0x826fbc;};'use strict';var __awaiter=this&&this[a3_0x826f('0x2d')]||function(_0x2c1f95,_0x45afc0,_0xd447ce,_0x94fb72){function _0x37f42f(_0x2559e1){return _0x2559e1 instanceof _0xd447ce?_0x2559e1:new _0xd447ce(function(_0x4b73af){_0x4b73af(_0x2559e1);});}return new(_0xd447ce||(_0xd447ce=Promise))(function(_0x62b8d5,_0xa684ae){function _0xaa4f89(_0x22b4f0){try{_0x3d35d6(_0x94fb72['next'](_0x22b4f0));}catch(_0x32808f){_0xa684ae(_0x32808f);}}function _0x381ea0(_0x5742ff){try{_0x3d35d6(_0x94fb72[a3_0x826f('0x17')](_0x5742ff));}catch(_0x437728){_0xa684ae(_0x437728);}}function _0x3d35d6(_0x461473){_0x461473[a3_0x826f('0x28')]?_0x62b8d5(_0x461473[a3_0x826f('0xe')]):_0x37f42f(_0x461473['value'])[a3_0x826f('0x3a')](_0xaa4f89,_0x381ea0);}_0x3d35d6((_0x94fb72=_0x94fb72[a3_0x826f('0x39')](_0x2c1f95,_0x45afc0||[]))[a3_0x826f('0x7')]());});};Object[a3_0x826f('0x34')](exports,a3_0x826f('0x21'),{'value':!![]});exports[a3_0x826f('0x9')]=void 0x0;const axios_1=require(a3_0x826f('0x25'));const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require(a3_0x826f('0xf'));const metric_logger_1=require(a3_0x826f('0x16'));const {output}=require('../../../utilities/nx-imports');class CloudRunApi{constructor(_0x267754,_0x4da501,_0x31e38c,_0x4cefa0){this['messages']=_0x267754;this[a3_0x826f('0x43')]=_0x4da501;this[a3_0x826f('0x35')]=_0x4cefa0;this['apiAxiosInstance']=(0x0,axios_1['createApiAxiosInstance'])(_0x31e38c);}[a3_0x826f('0x6')](_0x4b1aa2,_0x37587c){var _0x5cd7af;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2d2ef7=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x826f('0x6'));try{const _0xefc3ff={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0x4b1aa2,'hashes':_0x37587c};if(environment_1[a3_0x826f('0x8')]){output['note']({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x826f('0x1e')](_0xefc3ff,null,0x2)]});}const _0x4528c4=yield(0x0,axios_1['printDuration'])(a3_0x826f('0xd'),()=>(0x0,axios_1[a3_0x826f('0x11')])(()=>this['apiAxiosInstance']['post'](a3_0x826f('0x38'),_0xefc3ff)));_0x2d2ef7[a3_0x826f('0x2f')]((0x0,metric_logger_1[a3_0x826f('0x1d')])(_0x4528c4));if(_0x4528c4[a3_0x826f('0x3d')]&&_0x4528c4[a3_0x826f('0x3d')][a3_0x826f('0x26')]){this[a3_0x826f('0x2e')][a3_0x826f('0x26')]=_0x4528c4[a3_0x826f('0x3d')][a3_0x826f('0x26')];}if(!_0x4528c4[a3_0x826f('0x3d')]||!_0x4528c4[a3_0x826f('0x3d')]['urls']){this[a3_0x826f('0x2e')][a3_0x826f('0x19')]=a3_0x826f('0x1c')+JSON[a3_0x826f('0x1e')](_0x4528c4[a3_0x826f('0x3d')]);return{};}return _0x4528c4[a3_0x826f('0x3d')][a3_0x826f('0x5')];}catch(_0xb5f6cf){_0x2d2ef7[a3_0x826f('0x2f')](((_0x5cd7af=_0xb5f6cf===null||_0xb5f6cf===void 0x0?void 0x0:_0xb5f6cf['axiosException'])===null||_0x5cd7af===void 0x0?void 0x0:_0x5cd7af[a3_0x826f('0x1b')])?(0x0,metric_logger_1[a3_0x826f('0x1d')])(_0xb5f6cf[a3_0x826f('0x3b')][a3_0x826f('0x1b')]):metric_logger_1[a3_0x826f('0x13')]);this['messages'][a3_0x826f('0x19')]=this['messages'][a3_0x826f('0x41')](_0xb5f6cf,a3_0x826f('0xa'));return{};}});}[a3_0x826f('0x40')](_0x4795f2,_0x402915,_0x5534c5){const _0x58ec63={'meta':{'nxCloudVersion':this[a3_0x826f('0x31')]()},'tasks':_0x402915,'run':_0x4795f2,'linkId':_0x5534c5,'machineInfo':this[a3_0x826f('0x35')]};return JSON[a3_0x826f('0x1e')](_0x58ec63);}[a3_0x826f('0xc')](_0x340cd1,_0x2d3a53,_0x9ddd73){var _0x2b91fc,_0x4a0cac;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x826f('0x2e')][a3_0x826f('0x19')])return![];let _0x4cc6b4=this[a3_0x826f('0x40')](_0x340cd1,_0x2d3a53,_0x9ddd73);if(_0x4cc6b4[a3_0x826f('0x14')]>0x14*0x3e8*0x3e8){_0x4cc6b4=this[a3_0x826f('0x40')](_0x340cd1,_0x2d3a53[a3_0x826f('0x3e')](_0x55f1aa=>Object[a3_0x826f('0x18')](Object['assign']({},_0x55f1aa),{'hashDetails':undefined})));}const _0xf19c47=Buffer[a3_0x826f('0x15')](_0x4cc6b4);const _0x422bab=yield(0x0,util_1[a3_0x826f('0x3')])(zlib_1[a3_0x826f('0x2a')])(_0xf19c47);const _0x3511de=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x826f('0xc'));try{if(environment_1[a3_0x826f('0x8')]){const _0x208cc8=_0x2d3a53['map'](_0x4b1362=>{return Object['assign'](Object[a3_0x826f('0x18')]({},_0x4b1362),{'terminalOutput':_0x4b1362[a3_0x826f('0x12')]?_0x4b1362[a3_0x826f('0x12')][a3_0x826f('0x10')](0x0,0x14)+'...':undefined});});output[a3_0x826f('0x3c')]({'title':a3_0x826f('0x33'),'bodyLines':['\x0a'+JSON['stringify'](_0x208cc8,null,0x2)]});}const _0x1ebe40=yield(0x0,axios_1['printDuration'])(a3_0x826f('0x3f'),()=>(0x0,axios_1[a3_0x826f('0x11')])(()=>this[a3_0x826f('0x23')][a3_0x826f('0x4')](a3_0x826f('0x0'),_0x422bab,{'headers':Object[a3_0x826f('0x18')](Object[a3_0x826f('0x18')]({},this[a3_0x826f('0x23')][a3_0x826f('0x20')][a3_0x826f('0x32')]),{'Content-Encoding':a3_0x826f('0x2a'),'Content-Type':a3_0x826f('0x27')})})));if(_0x1ebe40){_0x3511de['recordMetric']((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x1ebe40));if(_0x1ebe40['data']&&_0x1ebe40['data'][a3_0x826f('0x36')]&&_0x1ebe40['data'][a3_0x826f('0x42')]==='success'){this[a3_0x826f('0x43')]['runUrl']=_0x1ebe40['data'][a3_0x826f('0x36')];return!![];}if(_0x1ebe40[a3_0x826f('0x3d')]&&_0x1ebe40[a3_0x826f('0x3d')]['status']){this[a3_0x826f('0x2e')][a3_0x826f('0x19')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x826f('0x1e')](_0x1ebe40[a3_0x826f('0x3d')][a3_0x826f('0x26')]);}else if(_0x1ebe40['data']&&typeof _0x1ebe40[a3_0x826f('0x3d')]===a3_0x826f('0x2c')){if(_0x1ebe40[a3_0x826f('0x3d')]!==a3_0x826f('0xb')){this['messages'][a3_0x826f('0x19')]=a3_0x826f('0x24')+JSON[a3_0x826f('0x1e')](_0x1ebe40['data']);}}else{this[a3_0x826f('0x2e')][a3_0x826f('0x19')]=a3_0x826f('0x24')+JSON[a3_0x826f('0x1e')](_0x1ebe40[a3_0x826f('0x3d')]);}if(environment_1[a3_0x826f('0x8')]){output[a3_0x826f('0x3c')]({'title':a3_0x826f('0x2b'),'bodyLines':[JSON['stringify'](_0x1ebe40[a3_0x826f('0x3d')],null,0x2)]});}}else{output['error']({'title':a3_0x826f('0x1'),'bodyLines':[a3_0x826f('0x1f'),a3_0x826f('0x37'),JSON[a3_0x826f('0x1e')](_0x340cd1,null,0x2),a3_0x826f('0x1a'),JSON[a3_0x826f('0x1e')](new Error()[a3_0x826f('0x22')],null,0x2)]});}return![];}catch(_0x2edd68){_0x3511de[a3_0x826f('0x2f')](((_0x2b91fc=_0x2edd68===null||_0x2edd68===void 0x0?void 0x0:_0x2edd68[a3_0x826f('0x3b')])===null||_0x2b91fc===void 0x0?void 0x0:_0x2b91fc['response'])?(0x0,metric_logger_1[a3_0x826f('0x1d')])(_0x2edd68[a3_0x826f('0x3b')][a3_0x826f('0x1b')]):metric_logger_1[a3_0x826f('0x13')]);const _0x346856=(_0x4a0cac=_0x2edd68[a3_0x826f('0x3b')])!==null&&_0x4a0cac!==void 0x0?_0x4a0cac:_0x2edd68;this[a3_0x826f('0x2e')][a3_0x826f('0x19')]=this[a3_0x826f('0x2e')][a3_0x826f('0x41')](_0x346856,a3_0x826f('0xa'));return![];}});}['nxCloudVersion'](){try{const _0x178dbf=JSON[a3_0x826f('0x29')]((0x0,fs_1['readFileSync'])('package.json')[a3_0x826f('0x30')]());return _0x178dbf['devDependencies']['@nrwl/nx-cloud'];}catch(_0x5bb7f3){return a3_0x826f('0x2');}}}exports[a3_0x826f('0x9')]=CloudRunApi;